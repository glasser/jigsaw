<!-- XXX get in document title -->
<!-- XXX put puzzle tags as CSS classes in body attrs -->

<template name='puzzlePage'>
  {{#if puzzle}}
    {{#with puzzle}}
       {{> puzzleTitle}}
       <div id='tagsAndMeta'>
         {{> tagList}}
         {{> familiesList }}
         {{> metadataList}}
       </div>
       {{! XXX spreadsheets }}
       {{! XXX related queries }}
       {{! XXX comments }}
       {{! XXX images }}
    {{/with}}
  {{else}}
    <h3>No such puzzle</h3>
  {{/if}}
</template>

<template name='puzzleTitle'>
  <h3 class='form-inline'>
    Puzzle:
    {{#show section='titleEditor' useEditButton=true}}
      <input type='text' id='setTitle' class='focus-titleEditor' value='{{title}}'>
    {{else}}
      {{title}}
    {{/show}}
  </h3>
</template>

<template name='tagList'>
  <div id='tagList'>
    <div class='form-inline'>
      Tags:
      {{#each sorted tags}}
        {{! XXX Link tag to tag search page }}
        <span class='tag'>{{ this }}</span>
        {{#if showing 'tagEditor'}}
          <button class='btn removeTag'><i class='icon-remove'></i></button>
        {{/if}}
      {{/each}}
      {{#show section='tagEditor' useEditButton=true hideIcon='ok'}}
        <span class='input-append'>
          <input type='text' id='addTag' class='focus-tagEditor' placeholder='new tag'>
          <button class='btn' id='addTagButton'><i class='icon-plus'></i></button>
        </span>
      {{/show}}
    </div>
  </div>
</template>

<template name='familiesList'>
  <div id='familiesList'>
    <ul>
      {{#each allFamilies}}
        <li>
          <div class='form-inline'>
            {{name}}:
            {{#show section=_id useEditButton=true}}
              XXX editor
            {{else}}
              {{! XXX link to search page }}
              <strong>{{familyValue}}</strong>
            {{/show}}
          </div>
        </li>
      {{/each}}
    </ul>
  </div>
</template>

<template name='metadataList'>
  <div id='metadataList'>
    <ul>
      {{#each allMetadata}}
        <li>
          <div class='form-inline'>
            {{name}}:
            {{#show section=_id useEditButton=true}}
              <input type='text' id='metadata-{{_id}}'
                     class='setMetadata focus-{{_id}}' value='{{metadataValue}}'>
            {{else}}
              {{#if url}}
                <a href='{{metadataValue}}' target='_blank'>{{metadataValue}}</a>
              {{else}}
                <strong>{{metadataValue}}</strong>
              {{/if}}
            {{/show}}
          </div>
        </li>
      {{/each}}
    </ul>
  </div>
</template>
